<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Obtaining adjusted `beta` estimates • winnerscurse</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Obtaining adjusted `beta` estimates">
<meta property="og:description" content="winnerscurse">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">winnerscurse</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/winners_curse_methods.html">Obtaining adjusted `beta` estimates</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="winners_curse_methods_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Obtaining adjusted <code>beta</code> estimates</h1>
            
      
      
      <div class="hidden name"><code>winners_curse_methods.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">winnerscurse</span><span class="op">)</span></code></pre></div>
<p>In order to demonstrate how this package can be used to obtain new adjusted <span class="math inline">\(\hat\beta\)</span> estimates, we first create a toy data set and subsequently, illustrate how a user could engage with each of the package’s functions using this data set. The methods currently available for implementation are:</p>
<ol style="list-style-type: decimal">
<li>Conditional Likelihood methods - <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2665019/">Ghosh <em>et al.</em> (2008)</a>
</li>
<li>Empirical Bayes method - <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4048064/">Ferguson <em>et al.</em> (2013)</a>
</li>
<li>FDR Inverse Quantile Transformation method - <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5013908/">Bigdeli <em>et al.</em> (2016)</a>
</li>
<li>Bootstrap method - adapted from <a href="https://onlinelibrary.wiley.com/doi/abs/10.1002/sim.4228">Faye <em>et al.</em> (2011)</a>
</li>
</ol>
<p>An important feature which distinguishes these four methods is detailed in the table below:</p>
<table class="table">
<colgroup>
<col width="53%">
<col width="47%">
</colgroup>
<thead><tr class="header">
<th>Adjusts <span class="math inline">\(\beta\)</span> estimate of <em>only</em> SNPs with <span class="math inline">\(p\)</span>-values less than specified threshold, <span class="math inline">\(\alpha\)</span>
</th>
<th>Adjusts <span class="math inline">\(\beta\)</span> estimate of <em>all</em> SNPs</th>
</tr></thead>
<tbody><tr class="odd">
<td><ul>
<li>Conditional Likelihood methods</li>
</ul></td>
<td><ul>
<li>Empirical Bayes method</li>
<li>FDR Inverse Quantile Transformation method</li>
<li>Bootstrap method</li>
</ul></td>
</tr></tbody>
</table>
<div id="creating-a-toy-data-set" class="section level3">
<h3 class="hasAnchor">
<a href="#creating-a-toy-data-set" class="anchor"></a>Creating a toy data set</h3>
<ul>
<li><p>We wish to generate summary statistics for 1 million SNPs, in which there exists a polygenic background of 10,000 SNPs while all others have no effects.</p></li>
<li>
<p>We specify:</p>
<ol style="list-style-type: decimal">
<li>the total number of SNPs</li>
<li>the number of SNPs truly associated with the trait</li>
<li>the number of samples</li>
<li>the minor allele frequency of each SNP</li>
<li>the variance explained in the trait by all SNPs, <span class="math inline">\(h^2\)</span>
</li>
</ol>
</li>
<li><p>With these specifications, we can obtain quite realistic summary statistics as shown below.</p></li>
<li><p>The summary statistics have been arranged here in a suitable way for each method - in the form of a <strong>data frame with columns <code>rsid</code>, <code>beta</code> and <code>se</code>.</strong></p></li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1998</span><span class="op">)</span>

<span class="va">n_snps</span> <span class="op">&lt;-</span> <span class="fl">10</span><span class="op">^</span><span class="fl">6</span>
<span class="va">effect_snps</span> <span class="op">&lt;-</span> <span class="fl">10000</span>
<span class="va">n_samples</span> <span class="op">&lt;-</span> <span class="fl">30000</span>

<span class="va">maf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">n_snps</span>,<span class="fl">0.01</span>,<span class="fl">0.5</span><span class="op">)</span>
<span class="va">se</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">n_samples</span><span class="op">*</span><span class="va">maf</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">maf</span><span class="op">)</span><span class="op">)</span>

<span class="va">true_beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">effect_snps</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>
<span class="va">h2</span> <span class="op">&lt;-</span> <span class="fl">0.7</span> <span class="co"># variance explained by effect SNPs</span>
<span class="va">var_y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">maf</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">effect_snps</span><span class="op">]</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">maf</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">effect_snps</span><span class="op">]</span><span class="op">)</span><span class="op">*</span><span class="va">true_beta</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">/</span><span class="va">h2</span>

<span class="va">true_beta</span> <span class="op">&lt;-</span> <span class="va">true_beta</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">var_y</span><span class="op">)</span> <span class="co"># scaling to represent a phenotype with variance 1</span>
<span class="va">true_beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">true_beta</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">n_snps</span><span class="op">-</span><span class="va">effect_snps</span><span class="op">)</span><span class="op">)</span>

<span class="va">summary_stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>rsid<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">n_snps</span><span class="op">)</span>,beta<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span>n<span class="op">=</span><span class="va">n_snps</span>,mean<span class="op">=</span><span class="va">true_beta</span>,sd<span class="op">=</span><span class="va">se</span><span class="op">)</span>,se<span class="op">=</span><span class="va">se</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">summary_stats</span><span class="op">)</span>
<span class="co">#&gt;   rsid         beta          se</span>
<span class="co">#&gt; 1    1 -0.014621130 0.024815677</span>
<span class="co">#&gt; 2    2  0.003692869 0.011860257</span>
<span class="co">#&gt; 3    3 -0.056894722 0.021248309</span>
<span class="co">#&gt; 4    4 -0.023764612 0.025252008</span>
<span class="co">#&gt; 5    5  0.028408413 0.008180033</span>
<span class="co">#&gt; 6    6 -0.001962928 0.009936883</span></code></pre></div>
</div>
<div id="method-1-conditional-likelihood---ghosh-et-al--2008" class="section level3">
<h3 class="hasAnchor">
<a href="#method-1-conditional-likelihood---ghosh-et-al--2008" class="anchor"></a>Method 1: Conditional Likelihood - Ghosh <em>et al.</em> (2008)</h3>
<ul>
<li><p>The function <code>conditional_likelihood</code> requires a data frame, in the form described above, and a value for <code>alpha</code>, the significance threshold used in the GWAS.</p></li>
<li><p>As the conditional likelihood methods have been designed to be only used for SNPs which are deemed significant, the data frame returned contains only SNPs that have <span class="math inline">\(p\)</span>-values below the inputted genome-wide significance threshold value, <code>alpha</code>.</p></li>
<li><p>If no SNPs are detected as significant, the function merely returns the inputted data frame.</p></li>
<li><p>The returned data frame has SNPs ordered based on their <span class="math inline">\(p\)</span>-values from smallest to largest, or equivalently, in descending order of <span class="math inline">\(\mid z \mid\)</span> in which <span class="math inline">\(z\)</span> is the estimated value for <span class="math inline">\(\beta\)</span> divided by its standard error.</p></li>
<li><p>We implement the function on our toy data set as follows, choosing a significance threshold of <code>5e-8</code>:</p></li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">out_CL</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/conditional_likelihood.html">conditional_likelihood</a></span><span class="op">(</span>summary_data <span class="op">=</span> <span class="va">summary_stats</span>, alpha <span class="op">=</span> <span class="fl">5e-8</span><span class="op">)</span> 
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">out_CL</span><span class="op">)</span>
<span class="co">#&gt;   rsid        beta          se    beta.cl1    beta.cl2    beta.cl3</span>
<span class="co">#&gt; 1 3965  0.06065460 0.008195368  0.06007821  0.05867879  0.05937850</span>
<span class="co">#&gt; 2 7815  0.06273957 0.008481947  0.06213728  0.06068079  0.06140904</span>
<span class="co">#&gt; 3 4998 -0.05957379 0.008340589 -0.05853882 -0.05654386 -0.05754134</span>
<span class="co">#&gt; 4 7261  0.05510613 0.008192669  0.05268826  0.04934930  0.05101878</span>
<span class="co">#&gt; 5 6510  0.05623502 0.008394748  0.05361460  0.05007375  0.05184418</span>
<span class="co">#&gt; 6 9917  0.05466573 0.008178854  0.05203302  0.04851799  0.05027550</span></code></pre></div>
<ul>
<li><p>Three columns have been added to the right of the inputted data frame: each represents a correction method suggested in <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2665019/">Ghosh <em>et al.</em> (2008)</a>. The first, <code>beta.cl1</code>, is referred to as the conditional MLE while the second, <code>beta.cl2</code>, is the mean of the normalized conditional likelihood. The third, <code>beta.cl3</code> is merely the average of the first two, known as the compromise estimator.</p></li>
<li><p>Ghosh <em>et al.</em> (2008) noted that for instances in which the true <span class="math inline">\(\beta\)</span> value is close to zero, <code>beta.cl2</code> often has greater mean squared error than <code>beta.cl1</code> but for true <span class="math inline">\(\beta\)</span> values further from zero, <code>beta.cl2</code> performs better. Thus, it was suggested that <code>beta.cl3</code> be used to combine the strengths of these two estimators. However, this function, <code>conditional_likelihood</code>, outputs values for all three estimators in order to allow the user to make their own decision on which they believe to be the most appropriate.</p></li>
</ul>
</div>
<div id="method-2-empirical-bayes---ferguson-et-al--2013" class="section level3">
<h3 class="hasAnchor">
<a href="#method-2-empirical-bayes---ferguson-et-al--2013" class="anchor"></a>Method 2: Empirical Bayes - Ferguson <em>et al.</em> (2013)</h3>
<ul>
<li><p>The function <code>empirical_bayes</code> implements the Empirical Bayes method for correcting for Winner’s Curse, detailed in <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4048064/">Ferguson <em>et al.</em> (2013)</a>, with a slight modification.</p></li>
<li><p>The function has one argument, <code>summary_data</code>, which is the data frame containing <code>rsid</code>, <code>beta</code> and <code>se</code> columns.</p></li>
<li><p>It returns this data frame but with a fourth column, <code>beta_EB</code> in which the adjusted estimates of this procedure have been added.</p></li>
<li><p>As the Empirical Bayes method makes adjustments to all SNPs, not only those that have been considered significant, this data frame contains all SNPs.</p></li>
<li><p><strong>Note:</strong> The conditional likelihood methods adjust each statistic one at a time, and so summary statistics of one individual SNP can easily be inputted into the <code>conditional_likelihood</code> function. However, the Empirical Bayes method requires many SNPs as the more information given to the function, the more accurate it will be at modelling the distribution and thus, making adjustments. Thus, if <code>summary_data</code> contains information related to only one SNP, <code>empirical_bayes</code> will merely return the inputted data frame.</p></li>
<li><p>Below is a demonstration of using <code>empirical_bayes</code> with our toy data set:</p></li>
</ul>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">out_EB</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/empirical_bayes.html">empirical_bayes</a></span><span class="op">(</span>summary_data <span class="op">=</span> <span class="va">summary_stats</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">out_EB</span><span class="op">)</span>
<span class="co">#&gt;   rsid        beta          se     beta_EB</span>
<span class="co">#&gt; 1 3965  0.06065460 0.008195368  0.05127859</span>
<span class="co">#&gt; 2 7815  0.06273957 0.008481947  0.05307172</span>
<span class="co">#&gt; 3 4998 -0.05957379 0.008340589 -0.05054678</span>
<span class="co">#&gt; 4 7261  0.05510613 0.008192669  0.04623384</span>
<span class="co">#&gt; 5 6510  0.05623502 0.008394748  0.04714389</span>
<span class="co">#&gt; 6 9917  0.05466573 0.008178854  0.04580840</span></code></pre></div>
<ul>
<li><p>Unfortunately, the Empirical Bayes estimator described by Ferguson <em>et al.</em> (2013) is known to perform poorly in the extreme tails of the distribution. Therefore, it is quite possible that a lack of adjustment for the <span class="math inline">\(\beta\)</span> values of SNPs with the most extreme <span class="math inline">\(z\)</span>-statistics could be witnessed with this method. A somewhat ad hoc approach to overcome this issue of combining the Empirical Bayes and the conditional likelihood methods was suggested by Ferguson <em>et al.</em> (2013).</p></li>
<li><p>In order to ensure that shrinkage does occur for the <span class="math inline">\(\beta\)</span> values of these extreme SNPs, it was decided that the following modification would be added to the <code>empirical_bayes</code> function detailed here. The basis function of the natural cubic spline has been altered so that the boundary knots are no longer the most extreme <span class="math inline">\(z\)</span>-values. Instead, the lower boundary knot is defined as the <span class="math inline">\(10^{\text{th}}\)</span> <span class="math inline">\(z\)</span>-statistic when the <span class="math inline">\(z\)</span>-statistics lie in increasing order while the upper boundary knot is the <span class="math inline">\(10^{\text{th}}\)</span> <span class="math inline">\(z\)</span>-statistic when the <span class="math inline">\(z\)</span>-statistics have been arranged in decreasing order. The natural cubic spline is then merely linear beyond these boundary knots. This assists in fixing the ‘tails’ issue discussed above. We see that the reduction of the estimated <span class="math inline">\(\beta\)</span> values for all of the top 6 most significant SNPs has occurred.</p></li>
</ul>
</div>
<div id="method-3-fdr-inverse-quantile-transformation---bigdeli-et-al--2016" class="section level3">
<h3 class="hasAnchor">
<a href="#method-3-fdr-inverse-quantile-transformation---bigdeli-et-al--2016" class="anchor"></a>Method 3: FDR Inverse Quantile Transformation - Bigdeli <em>et al.</em> (2016)</h3>
<ul>
<li><p>The function <code>FDR_IQT</code> implements the winner’s curse adjustment method detailed in <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5013908/">Bigdeli <em>et al.</em> (2016)</a>.</p></li>
<li><p>Similar to the approaches above, the function requires a data frame with three columns <code>rsid</code>, <code>beta</code> and <code>se</code>.</p></li>
<li><p>It also has an argument <code>min_pval</code>, for which the default setting is <code>1e-15</code>. This is included in order to avoid zero <span class="math inline">\(p\)</span>-values which can prove problematic for the function when evaluating <code><a href="https://rdrr.io/r/stats/Normal.html">qnorm()</a></code>. Furthermore, due to the nature of winner’s curse, it is in fact rare that observations with <span class="math inline">\(\mid z \mid &gt; 8\)</span> are biased.</p></li>
<li><p>The function outputs a data frame similar to that inputted with an additional column containing the adjusted estimate, <code>beta_FIQT</code>, and again, the SNPs have been reordered according to their individual <span class="math inline">\(z\)</span>-statistics.</p></li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">out_FIQT</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/FDR_IQT.html">FDR_IQT</a></span><span class="op">(</span>summary_data <span class="op">=</span> <span class="va">summary_stats</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">out_FIQT</span><span class="op">)</span>
<span class="co">#&gt;   rsid        beta          se   beta_FIQT</span>
<span class="co">#&gt; 1 3965  0.06065460 0.008195368  0.04418849</span>
<span class="co">#&gt; 2 7815  0.06273957 0.008481947  0.04573369</span>
<span class="co">#&gt; 3 4998 -0.05957379 0.008340589 -0.04270573</span>
<span class="co">#&gt; 4 7261  0.05510613 0.008192669  0.03783105</span>
<span class="co">#&gt; 5 6510  0.05623502 0.008394748  0.03876418</span>
<span class="co">#&gt; 6 9917  0.05466573 0.008178854  0.03776726</span></code></pre></div>
</div>
<div id="method-4-bootstrap---adapted-from-faye-et-al--2011" class="section level3">
<h3 class="hasAnchor">
<a href="#method-4-bootstrap---adapted-from-faye-et-al--2011" class="anchor"></a>Method 4: Bootstrap - adapted from Faye <em>et al.</em> (2011)</h3>
<ul>
<li><p>Inspired by the winner’s curse adjustment method detailed in <a href="https://onlinelibrary.wiley.com/doi/abs/10.1002/sim.4228">Faye <em>et al.</em> (2011)</a>, the function <code>BR_ss</code> implements a computationally efficient bootstrap method which is suitable for use with summary statistics.</p></li>
<li><p><code>BR_ss</code> takes a data frame <code>summary_data</code> with three columns: <code>rsid</code>, <code>beta</code>, <code>se</code>, and returns the inputted data frame along with the adjusted estimate for <span class="math inline">\(\beta\)</span>, <code>beta_BR_ss</code>.</p></li>
</ul>
<p><span class="math inline">\(~\)</span></p>
<p><strong>Method description:</strong></p>
<ul>
<li><p>First, the <span class="math inline">\(N\)</span> SNPs are arranged according to their naive <span class="math inline">\(z\)</span>-statistics, <span class="math inline">\(\frac{\hat\beta}{\text{se}(\hat\beta)}\)</span>, in descending order and given rank <span class="math inline">\(k\)</span>. Thus, the SNP with the largest positive original <span class="math inline">\(z\)</span>-statistic is given rank <span class="math inline">\(k=1\)</span> while the SNP with the largest negative original <span class="math inline">\(z\)</span>-statistic receives rank <span class="math inline">\(k=N\)</span>.</p></li>
<li><p>Following this, a parametric bootstrap is performed in which a value <span class="math inline">\(\hat\beta^{\text{b}}_{(k)}\)</span> is simulated for SNP <span class="math inline">\(k\)</span> from the distribution: <span class="math display">\[\hat\beta^{\text{b}}_{(k)} \sim N(\hat\beta_{(k)}, \text{se}(\hat\beta_{(k)})).\]</span> Upon obtaining <span class="math inline">\(\hat\beta^{\text{b}}\)</span>, SNPs undergo a second ordering in which they are arranged based on <span class="math inline">\(z^{\text{b}}\)</span>-statistics and receive a rank <span class="math inline">\(A(k)\)</span> accordingly. The <span class="math inline">\(z^{\text{b}}_{(k)}\)</span>-statistic of SNP <span class="math inline">\(k\)</span> is equal to <span class="math inline">\(\frac{\hat\beta^{\text{b}}_{(k)}}{\text{se}(\hat\beta_{(k)})}\)</span>.</p></li>
<li><p>An estimate for the bias correction value of SNP <span class="math inline">\(k\)</span> is given as: <span class="math display">\[\text{bias}_{(k)} = \frac{\hat\beta^{\text{b}}_{A(k)} - \hat\beta^{\text{oob}}_{A(k)}}{\text{se}(\hat\beta_{A(k)})} = \frac{\hat\beta^{\text{b}}_{A(k)} - \hat\beta_{A(k)}}{\text{se}(\hat\beta_{A(k)})}, \]</span>in which <span class="math inline">\(\hat\beta^{\text{b}}_{A(k)}\)</span> is the bootstrap value of the SNP ranked in position <span class="math inline">\(k\)</span> in the second ordering, <span class="math inline">\(\hat\beta^{\text{oob}}_{A(k)} = \hat\beta_{A(k)}\)</span> is that same SNP’s naive <span class="math inline">\(\beta\)</span> estimate and <span class="math inline">\(\text{se}(\hat\beta_{A(k)})\)</span> it’s standard error.</p></li>
<li><p>Next, a LOESS curve is fitted to the data in which <span class="math inline">\(z_{(k)}\)</span>-statistics are considered as the inputs and <span class="math inline">\(\text{bias}_{(k)}\)</span>, their corresponding outputs. As we are often dealing with very large numbers of SNPs, a LOESS curve is only fitted for the most significant SNPs. The <code>BR_ss</code> function currently fits one LOESS curve for the SNPs ranked in the top <span class="math inline">\(1\%\)</span> of positions and another one for those ranked in the bottom <span class="math inline">\(1\%\)</span>. A linear regression is used for all other SNPs. The predicted values from this process provides <span class="math inline">\(\text{bias}^{*}_{(k)}\)</span> for each SNP. Using <span class="math inline">\(\text{bias}^{*}_{(k)}\)</span> instead of <span class="math inline">\(\text{bias}_{(k)}\)</span> results in a faster approach with increased accuracy as only one bootstrap iteration for each SNP is sufficient for competitive performance.</p></li>
<li><p>Finally, the new estimate for <span class="math inline">\(\beta\)</span> for SNP <span class="math inline">\(k\)</span> is defined as follows: <span class="math display">\[\hat\beta_{(k)}^{*} = \hat\beta_{(k)} - \text{se}(\hat\beta_{(k)}) \cdot  \text{bias}^{*}_{(k)}.\]</span></p></li>
</ul>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">out_BR_ss</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/BR_ss.html">BR_ss</a></span><span class="op">(</span>summary_data <span class="op">=</span> <span class="va">summary_stats</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">out_BR_ss</span><span class="op">)</span>
<span class="co">#&gt;   rsid        beta          se  beta_BR_ss</span>
<span class="co">#&gt; 1 3965  0.06065460 0.008195368  0.05144091</span>
<span class="co">#&gt; 2 7815  0.06273957 0.008481947  0.05318579</span>
<span class="co">#&gt; 3 4998 -0.05957379 0.008340589 -0.04327338</span>
<span class="co">#&gt; 4 7261  0.05510613 0.008192669  0.04277757</span>
<span class="co">#&gt; 5 6510  0.05623502 0.008394748  0.04346218</span>
<span class="co">#&gt; 6 9917  0.05466573 0.008178854  0.04214637</span></code></pre></div>
</div>
<div id="comparing-results" class="section level3">
<h3 class="hasAnchor">
<a href="#comparing-results" class="anchor"></a>Comparing Results</h3>
<p>As we have simulated our data set, we have the ability to quantify the amount of bias present in the original naive <span class="math inline">\(\beta\)</span> estimates and also, in our adjusted estimates for each method. We can use measures such as the sum of squared differences and mean of absolute differences to assess this bias. First, we take a look at the conditional likelihood method as follows, in which only SNPs that are originally deemed significant are included:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sq_diff_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>naive <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out_CL</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out_CL</span><span class="op">$</span><span class="va">beta</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, beta.cl1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out_CL</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out_CL</span><span class="op">$</span><span class="va">beta.cl1</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,  beta.cl2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out_CL</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out_CL</span><span class="op">$</span><span class="va">beta.cl2</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,  beta.cl3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out_CL</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out_CL</span><span class="op">$</span><span class="va">beta.cl3</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="va">sq_diff_1</span>
<span class="co">#&gt;        naive   beta.cl1    beta.cl2    beta.cl3</span>
<span class="co">#&gt; 1 0.01315662 0.01101162 0.004883232 0.007294572</span>

<span class="va">mean_abs_diff_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>naive <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out_CL</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out_CL</span><span class="op">$</span><span class="va">beta</span><span class="op">)</span><span class="op">)</span>, beta.cl1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out_CL</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out_CL</span><span class="op">$</span><span class="va">beta.cl1</span><span class="op">)</span><span class="op">)</span>,  beta.cl2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out_CL</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out_CL</span><span class="op">$</span><span class="va">beta.cl2</span><span class="op">)</span><span class="op">)</span>,  beta.cl3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out_CL</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out_CL</span><span class="op">$</span><span class="va">beta.cl3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">mean_abs_diff_1</span>
<span class="co">#&gt;       naive   beta.cl1   beta.cl2   beta.cl3</span>
<span class="co">#&gt; 1 0.0165569 0.01499394 0.00962575 0.01214906</span></code></pre></div>
<p>For both quantities, the values for all three conditional likelihood methods are less than that of the naive estimate.</p>
<p>Next, we investigate the other three methods described above which take into account all SNPs, not just those with <span class="math inline">\(p\)</span>-values less than a specified threshold.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sq_diff_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>naive <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out_EB</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out_EB</span><span class="op">$</span><span class="va">beta</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, beta_EB <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out_EB</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out_EB</span><span class="op">$</span><span class="va">beta_EB</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, beta_FIQT <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out_FIQT</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out_FIQT</span><span class="op">$</span><span class="va">beta_FIQT</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, beta_BR_ss <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out_BR_ss</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out_BR_ss</span><span class="op">$</span><span class="va">beta_BR_ss</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="va">sq_diff_2</span>
<span class="co">#&gt;      naive  beta_EB beta_FIQT beta_BR_ss</span>
<span class="co">#&gt; 1 155.8134 1.840767  1.867324   15.14471</span>

<span class="va">mean_abs_diff_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>naive <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out_EB</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out_EB</span><span class="op">$</span><span class="va">beta</span><span class="op">)</span><span class="op">)</span>, beta_EB <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out_EB</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out_EB</span><span class="op">$</span><span class="va">beta_EB</span><span class="op">)</span><span class="op">)</span>, beta_FIQT <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out_FIQT</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out_FIQT</span><span class="op">$</span><span class="va">beta_FIQT</span><span class="op">)</span><span class="op">)</span>, beta_BR_ss <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out_BR_ss</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out_BR_ss</span><span class="op">$</span><span class="va">beta_BR_ss</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">mean_abs_diff_2</span>
<span class="co">#&gt;         naive      beta_EB    beta_FIQT  beta_BR_ss</span>
<span class="co">#&gt; 1 0.009103713 0.0002069327 0.0002557444 0.002788049</span></code></pre></div>
<p>Again, we see that in both cases, the value associated with the naive estimate is greatest. This assures us that the new adjusted estimates provided by each method are indeed less biased than the original <span class="math inline">\(\beta\)</span> estimate.</p>
<p>Finally, we can compare the performance of all methods for the SNPs with raw <span class="math inline">\(p\)</span>-values less than <code>5e-8</code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">out_EB_sig</span> <span class="op">&lt;-</span> <span class="va">out_EB</span><span class="op">[</span><span class="fl">2</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">pnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">out_EB</span><span class="op">$</span><span class="va">beta</span><span class="op">/</span><span class="va">out_EB</span><span class="op">$</span><span class="va">se</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">5e-8</span>,<span class="op">]</span>
<span class="va">out_FIQT_sig</span> <span class="op">&lt;-</span> <span class="va">out_FIQT</span><span class="op">[</span><span class="fl">2</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">pnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">out_FIQT</span><span class="op">$</span><span class="va">beta</span><span class="op">/</span><span class="va">out_FIQT</span><span class="op">$</span><span class="va">se</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">5e-8</span>,<span class="op">]</span>
<span class="va">out_BR_ss_sig</span> <span class="op">&lt;-</span> <span class="va">out_BR_ss</span><span class="op">[</span><span class="fl">2</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">pnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">out_BR_ss</span><span class="op">$</span><span class="va">beta</span><span class="op">/</span><span class="va">out_BR_ss</span><span class="op">$</span><span class="va">se</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">5e-8</span>,<span class="op">]</span>


<span class="va">sq_diff_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>naive <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out_CL</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out_CL</span><span class="op">$</span><span class="va">beta</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, beta.cl1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out_CL</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out_CL</span><span class="op">$</span><span class="va">beta.cl1</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,  beta.cl2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out_CL</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out_CL</span><span class="op">$</span><span class="va">beta.cl2</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,  beta.cl3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out_CL</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out_CL</span><span class="op">$</span><span class="va">beta.cl3</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, beta_EB <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out_EB_sig</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out_EB_sig</span><span class="op">$</span><span class="va">beta_EB</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, beta_FIQT <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out_FIQT_sig</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out_FIQT_sig</span><span class="op">$</span><span class="va">beta_FIQT</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, beta_BR_ss <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out_BR_ss_sig</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out_BR_ss_sig</span><span class="op">$</span><span class="va">beta_BR_ss</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="va">sq_diff_3</span>
<span class="co">#&gt;        naive   beta.cl1    beta.cl2    beta.cl3     beta_EB   beta_FIQT</span>
<span class="co">#&gt; 1 0.01315662 0.01101162 0.004883232 0.007294572 0.005316499 0.003634958</span>
<span class="co">#&gt;    beta_BR_ss</span>
<span class="co">#&gt; 1 0.003312614</span>

<span class="va">mean_abs_diff_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>naive <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out_CL</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out_CL</span><span class="op">$</span><span class="va">beta</span><span class="op">)</span><span class="op">)</span>, beta.cl1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out_CL</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out_CL</span><span class="op">$</span><span class="va">beta.cl1</span><span class="op">)</span><span class="op">)</span>,  beta.cl2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out_CL</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out_CL</span><span class="op">$</span><span class="va">beta.cl2</span><span class="op">)</span><span class="op">)</span>,  beta.cl3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out_CL</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out_CL</span><span class="op">$</span><span class="va">beta.cl3</span><span class="op">)</span><span class="op">)</span>, beta_EB <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out_EB_sig</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out_EB_sig</span><span class="op">$</span><span class="va">beta_EB</span><span class="op">)</span><span class="op">)</span>, beta_FIQT <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out_FIQT_sig</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out_FIQT_sig</span><span class="op">$</span><span class="va">beta_FIQT</span><span class="op">)</span><span class="op">)</span>, beta_BR_ss <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out_BR_ss_sig</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out_BR_ss_sig</span><span class="op">$</span><span class="va">beta_BR_ss</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">mean_abs_diff_3</span>
<span class="co">#&gt;       naive   beta.cl1   beta.cl2   beta.cl3     beta_EB   beta_FIQT</span>
<span class="co">#&gt; 1 0.0165569 0.01499394 0.00962575 0.01214906 0.009191089 0.007023357</span>
<span class="co">#&gt;    beta_BR_ss</span>
<span class="co">#&gt; 1 0.006779887</span></code></pre></div>
<p><span class="math inline">\(~\)</span> <span class="math inline">\(~\)</span></p>
<p>In addition, we can gain a visual insight into the adjustments made by these functions by plotting the adjusted <em>absolute</em> values along with the naive estimates and the true <em>absolute</em> <span class="math inline">\(\beta\)</span> values of SNPs which are originally deemed as significant, i.e. those with raw <span class="math inline">\(p\)</span>-values less than <code>5e-8</code>, as follows:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st">"RColorBrewer"</span><span class="op">)</span>
<span class="va">col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span><span class="op">(</span><span class="fl">8</span>,<span class="st">"Dark2"</span><span class="op">)</span>
  
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html">density</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">out_EB_sig</span><span class="op">$</span><span class="va">beta</span><span class="op">)</span><span class="op">)</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">80</span><span class="op">)</span>,xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.01</span>,<span class="fl">0.09</span><span class="op">)</span>,main<span class="op">=</span><span class="st">"Comparing Winner's Curse Methods"</span>,col<span class="op">=</span><span class="va">col</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html">density</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out_CL</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,col<span class="op">=</span><span class="va">col</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html">density</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">out_FIQT_sig</span><span class="op">$</span><span class="va">beta_FIQT</span><span class="op">)</span><span class="op">)</span>,col<span class="op">=</span><span class="va">col</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html">density</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">out_CL</span><span class="op">$</span><span class="va">beta.cl1</span><span class="op">)</span><span class="op">)</span>,col<span class="op">=</span><span class="va">col</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html">density</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">out_CL</span><span class="op">$</span><span class="va">beta.cl2</span><span class="op">)</span><span class="op">)</span>,col<span class="op">=</span><span class="va">col</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html">density</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">out_CL</span><span class="op">$</span><span class="va">beta.cl3</span><span class="op">)</span><span class="op">)</span>,col<span class="op">=</span><span class="va">col</span><span class="op">[</span><span class="fl">6</span><span class="op">]</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html">density</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">out_EB_sig</span><span class="op">$</span><span class="va">beta_EB</span><span class="op">)</span><span class="op">)</span>,col<span class="op">=</span><span class="va">col</span><span class="op">[</span><span class="fl">7</span><span class="op">]</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html">density</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">out_BR_ss_sig</span><span class="op">$</span><span class="va">beta_BR_ss</span><span class="op">)</span><span class="op">)</span>,col<span class="op">=</span><span class="va">col</span><span class="op">[</span><span class="fl">8</span><span class="op">]</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.008</span>, <span class="fl">77.5</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"beta_naive"</span>, <span class="st">"true_beta"</span>,<span class="st">"beta_FIQT"</span>,<span class="st">"beta.cl1"</span>,<span class="st">"beta.cl2"</span>,<span class="st">"beta.cl3"</span>,<span class="st">"beta_EB"</span>, <span class="st">"beta_BR_ss"</span><span class="op">)</span>,
       col<span class="op">=</span><span class="va">col</span>,lty<span class="op">=</span><span class="fl">1</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="winners_curse_methods_files/figure-html/unnamed-chunk-10-1.png" width="624"></p>
<p><span class="math inline">\(~\)</span> <span class="math inline">\(~\)</span></p>
<p><strong>TO DO:</strong></p>
<ul>
<li><em>Estimation of variance/standard errors for the adjusted <span class="math inline">\(\beta\)</span> estimates given by all methods.</em></li>
<li><em>How to let data make decision on number of SNPs to use in the extremes for <code>empirical_bayes</code> and number of SNPs used in loess in <code>BR_ss</code>?</em></li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Amanda Forde.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
