<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Methods for use with discovery and replication GWASs • winnerscurse</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/lumen/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Methods for use with discovery and replication GWASs">
<meta property="og:description" content="winnerscurse">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">winnerscurse</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/amandaforde/winners_curse" class="external-link">Source</a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Methods for use with discovery and replication
GWASs</h1>
            
      
      
      <div class="hidden name"><code>discovery_replication.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://amandaforde.github.io/winnerscurse/" class="external-link">winnerscurse</a></span><span class="op">)</span></span></code></pre></div>
<p>This package also includes methods which use both a discovery data
set and a replication data set in order to obtain a less biased estimate
of <span class="math inline">\(\beta\)</span>. Similar to the
demonstration of methods which use just the discovery data set, we will
first create two toy data sets and then, illustrate how a user may
employ the package’s functions to adjust for the bias imposed by
winner’s curse. The methods that are currently accessible include:</p>
<ol style="list-style-type: decimal">
<li>Conditional Likelihood method - adapted from <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2536726/" class="external-link">Zhong and
Prentice (2008)</a>
</li>
<li>UMVCUE method - <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2726957/" class="external-link">Bowden and
Dudbridge (2009)</a>
</li>
</ol>
<p>It is important to note that with both of these methods, adjustments
are only made to SNPs that are deemed significant in the discovery data
set, i.e. these SNPs have a <span class="math inline">\(p\)</span>-value
less than that of the specified threshold, <span class="math inline">\(\alpha\)</span>.</p>
<p>A third method has been added which obtains a new association
estimate for each significant SNP in the discovery data set using a
combination of the discovery and replication estimates:</p>
<ol start="3" style="list-style-type: decimal">
<li>MSE minimization method - based on <a href="https://pubmed.ncbi.nlm.nih.gov/28745132/" class="external-link">Ferguson et
al. (2017)</a>
</li>
</ol>
<div class="section level3">
<h3 id="addition-of-toy-replication-data-set">Addition of toy replication data set<a class="anchor" aria-label="anchor" href="#addition-of-toy-replication-data-set"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1998</span><span class="op">)</span></span>
<span><span class="va">n_snps</span> <span class="op">&lt;-</span> <span class="fl">10</span><span class="op">^</span><span class="fl">6</span></span>
<span><span class="va">effect_snps</span> <span class="op">&lt;-</span> <span class="fl">0.01</span><span class="op">*</span><span class="va">n_snps</span></span>
<span><span class="va">n_samples</span> <span class="op">&lt;-</span> <span class="fl">30000</span></span>
<span><span class="va">maf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n_snps</span>,<span class="fl">0.01</span>,<span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="va">true_beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">effect_snps</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">h2</span> <span class="op">&lt;-</span> <span class="fl">0.7</span> <span class="co"># variance explained by effect SNPs</span></span>
<span><span class="va">var_y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">maf</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">effect_snps</span><span class="op">]</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">maf</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">effect_snps</span><span class="op">]</span><span class="op">)</span><span class="op">*</span><span class="va">true_beta</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">/</span><span class="va">h2</span></span>
<span><span class="va">true_beta</span> <span class="op">&lt;-</span> <span class="va">true_beta</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">var_y</span><span class="op">)</span> <span class="co"># scaling to represent a phenotype with variance 1</span></span>
<span><span class="va">true_beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">true_beta</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">n_snps</span><span class="op">-</span><span class="va">effect_snps</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">se</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fl">2</span><span class="op">*</span><span class="va">maf</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">maf</span><span class="op">)</span><span class="op">*</span><span class="va">true_beta</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="op">(</span><span class="va">n_samples</span><span class="op">-</span><span class="fl">2</span><span class="op">)</span><span class="op">*</span><span class="va">maf</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">maf</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">stats_disc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>rsid<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">n_snps</span><span class="op">)</span>,beta<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n<span class="op">=</span><span class="va">n_snps</span>,mean<span class="op">=</span><span class="va">true_beta</span>,sd<span class="op">=</span><span class="va">se</span><span class="op">)</span>,se<span class="op">=</span><span class="va">se</span><span class="op">)</span></span>
<span></span>
<span><span class="va">n_samples_rep</span> <span class="op">&lt;-</span> <span class="fl">300000</span></span>
<span><span class="va">se_rep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fl">2</span><span class="op">*</span><span class="va">maf</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">maf</span><span class="op">)</span><span class="op">*</span><span class="va">true_beta</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="op">(</span><span class="va">n_samples_rep</span><span class="op">-</span><span class="fl">2</span><span class="op">)</span><span class="op">*</span><span class="va">maf</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">maf</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">stats_rep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>rsid<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">n_snps</span><span class="op">)</span>,beta<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n<span class="op">=</span><span class="va">n_snps</span>,mean<span class="op">=</span><span class="va">true_beta</span>,sd<span class="op">=</span><span class="va">se_rep</span><span class="op">)</span>,se<span class="op">=</span><span class="va">se_rep</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">stats_disc</span><span class="op">)</span></span>
<span><span class="co">#&gt;   rsid         beta          se</span></span>
<span><span class="co">#&gt; 1    1 -0.014621777 0.024816486</span></span>
<span><span class="co">#&gt; 2    2  0.003693032 0.011860650</span></span>
<span><span class="co">#&gt; 3    3 -0.056895857 0.021248869</span></span>
<span><span class="co">#&gt; 4    4 -0.023764922 0.025252738</span></span>
<span><span class="co">#&gt; 5    5  0.028410276 0.008177783</span></span>
<span><span class="co">#&gt; 6    6 -0.001963061 0.009937206</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">stats_rep</span><span class="op">)</span></span>
<span><span class="co">#&gt;   rsid         beta          se</span></span>
<span><span class="co">#&gt; 1    1 -0.004533234 0.007847427</span></span>
<span><span class="co">#&gt; 2    2  0.002738190 0.003750554</span></span>
<span><span class="co">#&gt; 3    3 -0.019410836 0.006719281</span></span>
<span><span class="co">#&gt; 4    4 -0.019199787 0.007985377</span></span>
<span><span class="co">#&gt; 5    5  0.036047493 0.002585964</span></span>
<span><span class="co">#&gt; 6    6  0.002438338 0.003142326</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="method-1-conditional-likelihood">Method 1: Conditional Likelihood<a class="anchor" aria-label="anchor" href="#method-1-conditional-likelihood"></a>
</h3>
<ul>
<li><p>The function <code>condlike_rep</code> implements a version of
the conditional likelihood method for obtaining bias-reduced estimates
of <span class="math inline">\(\beta\)</span> described in <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2536726/" class="external-link">Zhong and
Prentice (2008)</a>.</p></li>
<li><p>The function requires as inputs two independent data sets, one
representing a discovery GWAS, <code>summary_disc</code>, and the other
a replication study with identical SNPs, <code>summary_rep</code>, as
well as a specification of the significance threshold,
<code>alpha</code>, to be used. As before, the data sets must be in the
form of data frames with columns <code>rsid</code>, <code>beta</code>
and <code>se</code>, all columns of the data frames must contain
numerical values and each row of both data frames must represent a
unique SNP, identified by <code>rsid</code>. SNPs must be in the exact
same order in both data sets, i.e. the identity
<code>summary_rep$rsid == summary_disc$rsid</code> must evaluate to
<code>TRUE</code>.</p></li>
<li><p>Furthermore, the parameter <code>conf_interval</code> in
<code>condlike_rep</code> provides the user with the option to obtain
confidence intervals for each of the adjusted association estimates. The
default setting is <code>conf_interval=FALSE</code>. Inserting
<code>conf_interval=TRUE</code> when using the function will return
three sets of lower and upper confidence interval boundaries for each
SNP, each set corresponding to a particular form of adjusted estimate.
The final parameter <code>conf_level</code> takes a numerical value
between 0 and 1 which specifies the confidence interval, with the
default being <code>0.95</code>.</p></li>
<li><p>In a similar manner to other functions included in the package,
<code>condlike_rep</code> returns a single data frame with SNPs
reordered based on significance. However, it only contains SNPs which
have been deemed significant in the discovery data set. The first 5
columns of the data frame details the inputted information;
<code>rsid</code>, <code>beta_disc</code>, <code>se_disc</code>,
<code>beta_rep</code>, <code>se_rep</code>. Following this,
<code>beta_com</code> is the inverse variance weighted estimate which is
formally defined as:<span class="math display">\[\hat\beta_{\text{com}}
= \frac{\sigma_2^2 \hat\beta_1 + \sigma_1^2 \hat\beta_2}{\sigma_1^2 +
\sigma_2^2},\]</span> in which <span class="math inline">\(\hat\beta_1\)</span> = <code>beta_disc</code>,
<span class="math inline">\(\hat\beta_2\)</span> =
<code>beta_rep</code>, <span class="math inline">\(\sigma_1\)</span> =
<code>se_disc</code> and <span class="math inline">\(\sigma_2\)</span> =
<code>se_rep</code>.</p></li>
<li><p>The method implemented here uses just one selection cut-point at
the first discovery stage as opposed to that described in <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2536726/" class="external-link">Zhong and
Prentice (2008)</a> in which two separate selection thresholds are used.
Thus, the maximum likelihood adjusted estimator, <code>beta_MLE</code>
is defined to maximize the conditional likelihood at the observed <span class="math inline">\(\hat\beta_{\text{com}}\)</span>:<span class="math display">\[\hat\beta_{\text{MLE}} = \arg \max_{\beta} \log
f(\hat\beta_{\text{com}}; \beta).\]</span> The conditional sampling
distribution, <span class="math inline">\(f(x;\beta)\)</span> is
approximated by: <span class="math display">\[f(x;\beta) =
\frac{\frac{1}{\sigma_{\text{com}}}
\phi\left(\frac{x-\beta}{\sigma_{\text{com}}}\right) \cdot
\left[\Phi\left(\frac{x-c\sigma_1}{\frac{\sigma_1}{\sigma_2}\sigma_{\text{com}}}\right)
+
\Phi\left(\frac{-x-c\sigma_1}{\frac{\sigma_1}{\sigma_2}\sigma_{\text{com}}}\right)\right]}{\Phi\left(\frac{\beta}{\sigma_1}
- c\right) + \Phi\left(- \frac{\beta}{\sigma_1} -
c\right)}.\]</span></p></li>
<li><p><span class="math inline">\(c\)</span> is the selection
cut-point, i.e. all SNPs with <span class="math inline">\(\mid
\frac{\hat\beta_1}{\sigma_1}\mid \ge c\)</span> are deemed as
significant. The value of <span class="math inline">\(c\)</span> is
easily obtained using the chosen <code>alpha</code>. In addition, <span class="math display">\[\sigma^2_{\text{com}} = \frac{\sigma_1^2
\sigma_2^2}{\sigma_1^2 + \sigma_2^2}.\]</span></p></li>
<li><p>Note that this function, <span class="math inline">\(f(x;\beta)\)</span> is slightly different from
that given in the paper as only one selection cut-point is imposed
here.</p></li>
<li><p>Finally, Zhong and Prectice (2008) noted that simulation studies
showed that <span class="math inline">\(\hat\beta_{\text{com}}\)</span>
tended to have upward bias while <span class="math inline">\(\hat\beta_{\text{MLE}}\)</span> over-corrected and
therefore, a combination of the two in the following form was proposed:
<span class="math display">\[\hat\beta_{\text{MSE}} =
\frac{\hat\sigma^2_{\text{com}}\cdot \hat\beta_{\text{com}} +
(\hat\beta_{\text{com}} -
\hat\beta_{\text{MLE}})^2\cdot\hat\beta_{\text{MLE}}}{\sigma^2_{\text{com}}+(\hat\beta_{\text{com}}
- \hat\beta_{\text{MLE}})^2}.\]</span> This <span class="math inline">\(\hat\beta_{\text{MSE}}\)</span> holds the final
column of the outputted data frame in the default setting.</p></li>
<li><p>The use of <code>condlike_rep</code> with our toy data sets in
which <code>conf_interval=FALSE</code> is demonstrated below, with a
significance threshold value of <code>10e-6</code>:</p></li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/condlike_rep.html">condlike_rep</a></span><span class="op">(</span>summary_disc<span class="op">=</span><span class="va">stats_disc</span>, summary_rep<span class="op">=</span><span class="va">stats_rep</span>, alpha<span class="op">=</span><span class="fl">10e-6</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">out1</span><span class="op">)</span></span>
<span><span class="co">#&gt;   rsid   beta_disc     se_disc    beta_rep      se_rep    beta_com    beta_MLE</span></span>
<span><span class="co">#&gt; 1 3965  0.06064760 0.008191123  0.05034712 0.002590183  0.05128348  0.05121019</span></span>
<span><span class="co">#&gt; 2 7815  0.06273204 0.008477889  0.04711212 0.002680864  0.04853203  0.04836559</span></span>
<span><span class="co">#&gt; 3 4998 -0.05956742 0.008336576 -0.04797101 0.002636178 -0.04902517 -0.04890038</span></span>
<span><span class="co">#&gt; 4 7261  0.05510736 0.008186396  0.05423749 0.002588688  0.05431656  0.05425300</span></span>
<span><span class="co">#&gt; 5 6510  0.05623389 0.008389116  0.05314707 0.002652792  0.05342768  0.05335028</span></span>
<span><span class="co">#&gt; 6 9917  0.05466029 0.008176299  0.04281451 0.002585495  0.04389134  0.04365907</span></span>
<span><span class="co">#&gt;      beta_MSE</span></span>
<span><span class="co">#&gt; 1  0.05128341</span></span>
<span><span class="co">#&gt; 2  0.04853133</span></span>
<span><span class="co">#&gt; 3 -0.04902487</span></span>
<span><span class="co">#&gt; 4  0.05431652</span></span>
<span><span class="co">#&gt; 5  0.05342761</span></span>
<span><span class="co">#&gt; 6  0.04388930</span></span></code></pre></div>
<p><span class="math inline">\(~\)</span></p>
<p><strong>Confidence intervals:</strong></p>
<ul>
<li><p>Firstly, the <span class="math inline">\((1-\alpha)\%\)</span>
confidence interval for <span class="math inline">\(\hat\beta_{\text{com}}\)</span> is simply
calculated as: <span class="math display">\[\hat\beta_{\text{com}} \pm
\hat\sigma_{\text{com}}Z_{1-\frac{\alpha}{2}}.\]</span>For <span class="math inline">\(\hat\beta_{\text{MLE}}\)</span>, the profile
confidence limits are the intersection of the log-likelihood curve with
a horizontal line <span class="math inline">\(\frac{\chi^2_{1,1-\alpha}}{2}\)</span> units below
its maximum. The MSE weighting method, as described above, can then be
easily applied to the upper and lower boundaries of these two confidence
intervals to obtain an appropriate confidence interval for <span class="math inline">\(\hat\beta_{\text{MSE}}\)</span>. This gives: <span class="math display">\[\hat\beta_{\text{MSE};\frac{\alpha}{2}} =
\hat{K}_{\frac{\alpha}{2}} \hat\beta_{\text{com};\frac{\alpha}{2}} +
\left(1-\hat{K}_{\frac{\alpha}{2}}\right)
\hat\beta_{\text{MLE};\frac{\alpha}{2}}\]</span> <span class="math display">\[\hat\beta_{\text{MSE};1-\frac{\alpha}{2}} =
\hat{K}_{1-\frac{\alpha}{2}} \hat\beta_{\text{com};1-\frac{\alpha}{2}} +
\left(1-\hat{K}_{1-\frac{\alpha}{2}}\right)
\hat\beta_{\text{MLE};1-\frac{\alpha}{2}}\]</span> in which <span class="math inline">\(\hat{K}_{\frac{\alpha}{2}} =
\frac{\hat\sigma^2_{\text{com}}}{\hat\sigma^2_{\text{com}} +
\left(\hat\beta_{\text{com};\frac{\alpha}{2}} -
\hat\beta_{\text{MLE};\frac{\alpha}{2}}\right)^2} \;\)</span> and <span class="math inline">\(\; \hat{K}_{1-\frac{\alpha}{2}} =
\frac{\hat\sigma^2_{\text{com}}}{\hat\sigma^2_{\text{com}} +
\left(\hat\beta_{\text{com};1-\frac{\alpha}{2}} -
\hat\beta_{\text{MLE};1-\frac{\alpha}{2}}\right)^2}.\)</span></p></li>
<li><p>We implement <code>condlike_rep</code> on our toy data sets with
<code>conf_interval</code> now set to <code>TRUE</code> to show the form
in which the output now takes. A similar data frame to that above is
returned with 95% confidence intervals also included for each adjusted
association estimate for each SNP.</p></li>
</ul>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out1_conf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/condlike_rep.html">condlike_rep</a></span><span class="op">(</span>summary_disc<span class="op">=</span><span class="va">stats_disc</span>, summary_rep<span class="op">=</span><span class="va">stats_rep</span>, alpha<span class="op">=</span><span class="fl">10e-6</span>, conf_interval<span class="op">=</span><span class="cn">TRUE</span>, conf_level<span class="op">=</span><span class="fl">0.95</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">out1_conf</span><span class="op">)</span></span>
<span><span class="co">#&gt;   rsid   beta_disc     se_disc    beta_rep      se_rep    beta_com</span></span>
<span><span class="co">#&gt; 1 3965  0.06064760 0.008191123  0.05034712 0.002590183  0.05128348</span></span>
<span><span class="co">#&gt; 2 7815  0.06273204 0.008477889  0.04711212 0.002680864  0.04853203</span></span>
<span><span class="co">#&gt; 3 4998 -0.05956742 0.008336576 -0.04797101 0.002636178 -0.04902517</span></span>
<span><span class="co">#&gt; 4 7261  0.05510736 0.008186396  0.05423749 0.002588688  0.05431656</span></span>
<span><span class="co">#&gt; 5 6510  0.05623389 0.008389116  0.05314707 0.002652792  0.05342768</span></span>
<span><span class="co">#&gt; 6 9917  0.05466029 0.008176299  0.04281451 0.002585495  0.04389134</span></span>
<span><span class="co">#&gt;   beta_com_lower beta_com_upper    beta_MLE beta_MLE_lower beta_MLE_upper</span></span>
<span><span class="co">#&gt; 1     0.04644305     0.05612390  0.05121019     0.04634750     0.05608599</span></span>
<span><span class="co">#&gt; 2     0.04352215     0.05354192  0.04836559     0.04329691     0.05344293</span></span>
<span><span class="co">#&gt; 3    -0.05395155    -0.04409880 -0.04890038    -0.05387616    -0.04392062</span></span>
<span><span class="co">#&gt; 4     0.04947893     0.05915419  0.05425300     0.04943259     0.05913523</span></span>
<span><span class="co">#&gt; 5     0.04847025     0.05838510  0.05335028     0.04838881     0.05835422</span></span>
<span><span class="co">#&gt; 6     0.03905968     0.04872300  0.04365907     0.03872583     0.04855722</span></span>
<span><span class="co">#&gt;      beta_MSE beta_MSE_lower beta_MSE_upper</span></span>
<span><span class="co">#&gt; 1  0.05128341     0.04644291     0.05612389</span></span>
<span><span class="co">#&gt; 2  0.04853133     0.04352041     0.05354177</span></span>
<span><span class="co">#&gt; 3 -0.04902487    -0.05395148    -0.04409791</span></span>
<span><span class="co">#&gt; 4  0.05431652     0.04947892     0.05915419</span></span>
<span><span class="co">#&gt; 5  0.05342761     0.04847017     0.05838510</span></span>
<span><span class="co">#&gt; 6  0.04388930     0.03905366     0.04872226</span></span></code></pre></div>
<ul>
<li>
<strong>Note:</strong> The current computation of confidence
intervals may not work in every situation and thus, ongoing work is
being done to resolve this.</li>
</ul>
</div>
<div class="section level3">
<h3 id="method-2-umvcue">Method 2: UMVCUE<a class="anchor" aria-label="anchor" href="#method-2-umvcue"></a>
</h3>
<ul>
<li><p>The implementation of <code>UMVCUE</code> is very similar to the
function described above in the sense that <code>UMVCUE</code> requires
the same inputs; discovery and replication data sets in the form of
three-columned data frames together with a threshold value,
<code>alpha</code>. Furthermore, the outputted data frame is in the same
form with just one extra column providing the adjusted estimate,
<code>beta_UMVCUE</code>.</p></li>
<li><p>Selection also occurs here at just one stage - SNPs are deemed as
significant if their <span class="math inline">\(p\)</span>-values
corresponding to <span class="math inline">\(\mid
\frac{\hat\beta_1}{\sigma_1}\mid\)</span> are smaller than the given
threshold.</p></li>
<li><p>The function <code>UMVCUE</code> executes the method detailed in
<a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2726957/" class="external-link">Bowden
and Dudbridge (2009)</a>. No adaptations have been made to the method
described.</p></li>
<li><p>It is worth noting that, as with all conditional likelihood
methods, the method used in <code>condlike_rep</code> makes adjustments
to each SNP one at a time with no information relating to other SNPs
required for this adjustment. However, after ordering SNPs based on
significance, for a single SNP, <code>UMVCUE</code> also uses the data
of SNPs on either side of it to assist with the adjustment.</p></li>
<li><p><code>UMVCUE</code> can be applied to the toy data sets as
followed, with <code>alpha</code> again specified as
<code>10e-6</code>:</p></li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/UMVCUE.html">UMVCUE</a></span><span class="op">(</span>summary_disc <span class="op">=</span> <span class="va">stats_disc</span>, summary_rep <span class="op">=</span> <span class="va">stats_rep</span>, alpha <span class="op">=</span> <span class="fl">10e-6</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">out2</span><span class="op">)</span></span>
<span><span class="co">#&gt;   rsid   beta_disc     se_disc    beta_rep      se_rep beta_UMVCUE</span></span>
<span><span class="co">#&gt; 1 3965  0.06064760 0.008191123  0.05034712 0.002590183  0.04996931</span></span>
<span><span class="co">#&gt; 2 7815  0.06273204 0.008477889  0.04711212 0.002680864  0.04722594</span></span>
<span><span class="co">#&gt; 3 4998 -0.05956742 0.008336576 -0.04797101 0.002636178 -0.04807677</span></span>
<span><span class="co">#&gt; 4 7261  0.05510736 0.008186396  0.05423749 0.002588688  0.05408398</span></span>
<span><span class="co">#&gt; 5 6510  0.05623389 0.008389116  0.05314707 0.002652792  0.05314277</span></span>
<span><span class="co">#&gt; 6 9917  0.05466029 0.008176299  0.04281451 0.002585495  0.04282613</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="method-3-mse-minimization">Method 3: MSE minimization<a class="anchor" aria-label="anchor" href="#method-3-mse-minimization"></a>
</h3>
<ul>
<li><p>The function <code>MSE_minimizer</code> implements a combination
method which closely follows that described in <a href="https://pubmed.ncbi.nlm.nih.gov/28745132/" class="external-link">Ferguson <em>et
al.</em> (2017)</a>. The function parameters used here;
<code>summary_disc</code>, <code>summary_rep</code> and
<code>alpha</code>, are precisely of the same form as those previously
detailed in this vignette. In addition, <code>MSE_minimizer</code> has a
logical parameter, namely <code>spline</code> which defaults as
<code>spline=TRUE</code>. As a smoothing spline is used in the execution
of this function, data corresponding to at least 5 SNPs is
required.</p></li>
<li><p>An adjusted estimate is computed for each SNP which has been
classified as significant in the discovery data set, based on the given
threshold. Thus, similar to the above method, <code>MSE_minimizer</code>
returns a data frame containing these significant SNPs with 6 columns in
which the final column contains the new estimate,
<code>beta_joint</code>.</p></li>
<li><p>Following the approach detailed in <a href="https://pubmed.ncbi.nlm.nih.gov/28745132/" class="external-link">Ferguson <em>et
al.</em> (2017)</a>, we define the adjusted linear combination estimator
as: <span class="math display">\[\hat\beta_{\text{joint}} =
\omega(\hat{B}) \cdot \hat\beta_{\text{rep}} + (1-\omega(\hat{B}))\cdot
\hat\beta_{\text{disc}}\]</span> in which <span class="math display">\[
\omega(\hat{B}) =
\frac{\frac{1}{\sigma^2_{\text{rep}}}}{\frac{1}{\sigma^2_{\text{rep}}}+\frac{1}{\sigma^2_{\text{disc}}+
\hat{B}^2}}.\]</span> When <code>spline=FALSE</code> is used, we simply
let <span class="math inline">\(\hat{B} = \hat\beta_{\text{disc}} -
\hat\beta_{\text{rep}}\)</span>. We make the assumptions that <span class="math inline">\(\beta_{\text{rep}}\)</span> is unbiased for <span class="math inline">\(\beta\)</span>, but <span class="math inline">\(\beta_{\text{disc}}\)</span> is quite likely to be
biased and that <span class="math inline">\(\beta_{\text{rep}}\)</span>
and <span class="math inline">\(\beta_{\text{disc}}\)</span> are
independent.</p></li>
<li><p>For the default setting <code>spline=TRUE</code>, a cubic
smoothing spline is applied in which the values of <span class="math inline">\(z_{\text{disc}} =
\frac{\hat\beta_{\text{disc}}}{\sigma_{\text{disc}}}\)</span> are
considered as inputs and <span class="math inline">\(\hat{B} =
\hat\beta_{\text{disc}} - \hat\beta_{\text{rep}}\)</span>, the
corresponding outputs. The predicted values for <span class="math inline">\(\hat{B}\)</span> from this process, <span class="math inline">\(\hat{B}^*\)</span> say, are then used instead of
<span class="math inline">\(\hat{B}\)</span> when computing <span class="math inline">\(\hat\beta_{\text{joint}}\)</span> for each
SNP.</p></li>
<li><p>We apply <code>MSE_minimizer</code> to our toy data sets, once
with the default setting for <code>spline</code> and once with
<code>spline=FALSE</code>. Again for convenient demonstration purposes,
we specify the significance threshold as <code>10e-6</code>.</p></li>
</ul>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MSE_minimizer.html">MSE_minimizer</a></span><span class="op">(</span>summary_disc <span class="op">=</span> <span class="va">stats_disc</span>, summary_rep <span class="op">=</span> <span class="va">stats_rep</span>, alpha<span class="op">=</span><span class="fl">10e-6</span>, spline<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">out4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MSE_minimizer.html">MSE_minimizer</a></span><span class="op">(</span>summary_disc <span class="op">=</span> <span class="va">stats_disc</span>, summary_rep <span class="op">=</span> <span class="va">stats_rep</span>, alpha<span class="op">=</span><span class="fl">10e-6</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">out3</span><span class="op">)</span></span>
<span><span class="co">#&gt;   rsid   beta_disc     se_disc    beta_rep      se_rep  beta_joint</span></span>
<span><span class="co">#&gt; 1 3965  0.06064760 0.008191123  0.05034712 0.002590183  0.05073125</span></span>
<span><span class="co">#&gt; 2 7815  0.06273204 0.008477889  0.04711212 0.002680864  0.04745963</span></span>
<span><span class="co">#&gt; 3 4998 -0.05956742 0.008336576 -0.04797101 0.002636178 -0.04835308</span></span>
<span><span class="co">#&gt; 4 7261  0.05510736 0.008186396  0.05423749 0.002588688  0.05431576</span></span>
<span><span class="co">#&gt; 5 6510  0.05623389 0.008389116  0.05314707 0.002652792  0.05339693</span></span>
<span><span class="co">#&gt; 6 9917  0.05466029 0.008176299  0.04281451 0.002585495  0.04318478</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">out4</span><span class="op">)</span></span>
<span><span class="co">#&gt;   rsid   beta_disc     se_disc    beta_rep      se_rep  beta_joint</span></span>
<span><span class="co">#&gt; 1 3965  0.06064760 0.008191123  0.05034712 0.002590183  0.05053320</span></span>
<span><span class="co">#&gt; 2 7815  0.06273204 0.008477889  0.04711212 0.002680864  0.04741218</span></span>
<span><span class="co">#&gt; 3 4998 -0.05956742 0.008336576 -0.04797101 0.002636178 -0.04806024</span></span>
<span><span class="co">#&gt; 4 7261  0.05510736 0.008186396  0.05423749 0.002588688  0.05426883</span></span>
<span><span class="co">#&gt; 5 6510  0.05623389 0.008389116  0.05314707 0.002652792  0.05326308</span></span>
<span><span class="co">#&gt; 6 9917  0.05466029 0.008176299  0.04281451 0.002585495  0.04324965</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="visualisation">Visualisation<a class="anchor" aria-label="anchor" href="#visualisation"></a>
</h3>
<ul>
<li><p>We can illustrate the performance of these three functions;
<code>condlike_rep</code>, <code>UMVCUE</code> and
<code>MSE_minimizer</code>, as follows. It is clear that all methods
show an improvement on the estimates obtained from the discovery data
set. However, the plots show that a further investigation will be
required in order to evaluate if the adjusted estimates are less biased
than the mere use of replication estimates.</p></li>
<li><p>In the second graph, it can be seen that there must be very
little difference between the replication estimates and those obtained
using <code>UMVCUE</code> as the density curves of <code>beta_rep</code>
and <code>beta_UMVCUE</code> nearly overlap completely.</p></li>
</ul>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st">"RColorBrewer"</span><span class="op">)</span></span>
<span><span class="va">col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html" class="external-link">brewer.pal</a></span><span class="op">(</span><span class="fl">8</span>,<span class="st">"Dark2"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">out1</span><span class="op">$</span><span class="va">beta_disc</span><span class="op">)</span><span class="op">)</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">68</span><span class="op">)</span>,xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.01</span>,<span class="fl">0.08</span><span class="op">)</span>,main<span class="op">=</span><span class="st">"Conditional Likelihood Winner's Curse Adjustment"</span>,col<span class="op">=</span><span class="va">col</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out1</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,col<span class="op">=</span><span class="va">col</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">out1</span><span class="op">$</span><span class="va">beta_rep</span><span class="op">)</span><span class="op">)</span>,col<span class="op">=</span><span class="va">col</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">out1</span><span class="op">$</span><span class="va">beta_com</span><span class="op">)</span><span class="op">)</span>,col<span class="op">=</span><span class="va">col</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">out1</span><span class="op">$</span><span class="va">beta_MLE</span><span class="op">)</span><span class="op">)</span>,col<span class="op">=</span><span class="va">col</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">out1</span><span class="op">$</span><span class="va">beta_MSE</span><span class="op">)</span><span class="op">)</span>,col<span class="op">=</span><span class="va">col</span><span class="op">[</span><span class="fl">8</span><span class="op">]</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">67.5</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"beta_disc"</span>, <span class="st">"true_beta"</span>,<span class="st">"beta_rep"</span>,<span class="st">"beta_com"</span>, <span class="st">"beta_MLE"</span>, <span class="st">"beta_MSE"</span><span class="op">)</span>,col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">col</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>,<span class="va">col</span><span class="op">[</span><span class="fl">8</span><span class="op">]</span><span class="op">)</span>,lty<span class="op">=</span><span class="fl">1</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="discovery_replication_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">out2</span><span class="op">$</span><span class="va">beta_disc</span><span class="op">)</span><span class="op">)</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">72</span><span class="op">)</span>,xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.01</span>,<span class="fl">0.08</span><span class="op">)</span>,main<span class="op">=</span><span class="st">"UMVCUE and MSE-minimizer Winner's Curse Adjustment"</span>,col<span class="op">=</span><span class="va">col</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out2</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,col<span class="op">=</span><span class="va">col</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">out2</span><span class="op">$</span><span class="va">beta_rep</span><span class="op">)</span><span class="op">)</span>,col<span class="op">=</span><span class="va">col</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">out2</span><span class="op">$</span><span class="va">beta_UMVCUE</span><span class="op">)</span><span class="op">)</span>,col<span class="op">=</span><span class="va">col</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">out3</span><span class="op">$</span><span class="va">beta_joint</span><span class="op">)</span><span class="op">)</span>,col<span class="op">=</span><span class="va">col</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">out4</span><span class="op">$</span><span class="va">beta_joint</span><span class="op">)</span><span class="op">)</span>,col<span class="op">=</span><span class="va">col</span><span class="op">[</span><span class="fl">6</span><span class="op">]</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">70.5</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"beta_disc"</span>, <span class="st">"true_beta"</span>,<span class="st">"beta_rep"</span>,<span class="st">"beta_UMVCUE"</span>, <span class="st">"beta_joint"</span>, <span class="st">"beta_joint_sp"</span><span class="op">)</span>,</span>
<span>       col<span class="op">=</span><span class="va">col</span>,lty<span class="op">=</span><span class="fl">1</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="discovery_replication_files/figure-html/unnamed-chunk-7-2.png" width="700"></p>
<ul>
<li>In addition, as the data sets are simulated, we can obtain measures
such as sum of squared differences and mean of absolute differences for
the various estimates, in a similar fashion to as we did in the previous
article describing ‘discovery only’ methods:</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sq_diff</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>disc_naive <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out2</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out2</span><span class="op">$</span><span class="va">beta_disc</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, rep_naive <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out2</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out2</span><span class="op">$</span><span class="va">beta_rep</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,  beta_UMVCUE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out2</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out2</span><span class="op">$</span><span class="va">beta_UMVCUE</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, beta_com <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out1</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out1</span><span class="op">$</span><span class="va">beta_com</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, beta_MLE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out1</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out1</span><span class="op">$</span><span class="va">beta_MLE</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, beta_MSE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out1</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out1</span><span class="op">$</span><span class="va">beta_MSE</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, beta_joint <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out3</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out3</span><span class="op">$</span><span class="va">beta_joint</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, beta_joint_sp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out4</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out4</span><span class="op">$</span><span class="va">beta_joint</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sq_diff</span></span>
<span><span class="co">#&gt;   disc_naive   rep_naive beta_UMVCUE    beta_com   beta_MLE    beta_MSE</span></span>
<span><span class="co">#&gt; 1 0.06867092 0.001304645 0.001276025 0.001708696 0.00131269 0.001470638</span></span>
<span><span class="co">#&gt;    beta_joint beta_joint_sp</span></span>
<span><span class="co">#&gt; 1 0.001302419   0.001357969</span></span>
<span></span>
<span><span class="va">mean_abs_diff</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>disc_naive <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out2</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out2</span><span class="op">$</span><span class="va">beta_disc</span><span class="op">)</span><span class="op">)</span>, rep_naive <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out2</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out2</span><span class="op">$</span><span class="va">beta_rep</span><span class="op">)</span><span class="op">)</span>,  beta_UMVCUE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out2</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out2</span><span class="op">$</span><span class="va">beta_UMVCUE</span><span class="op">)</span><span class="op">)</span>, beta_com <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out1</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out1</span><span class="op">$</span><span class="va">beta_com</span><span class="op">)</span><span class="op">)</span>,beta_MLE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out1</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out1</span><span class="op">$</span><span class="va">beta_MLE</span><span class="op">)</span><span class="op">)</span>, beta_MSE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out1</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out1</span><span class="op">$</span><span class="va">beta_MSE</span><span class="op">)</span><span class="op">)</span>, beta_joint <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out3</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out3</span><span class="op">$</span><span class="va">beta_joint</span><span class="op">)</span><span class="op">)</span>, beta_joint_sp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out4</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out4</span><span class="op">$</span><span class="va">beta_joint</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mean_abs_diff</span></span>
<span><span class="co">#&gt;   disc_naive   rep_naive beta_UMVCUE   beta_com  beta_MLE    beta_MSE</span></span>
<span><span class="co">#&gt; 1 0.01593473 0.002368839 0.002328191 0.00269438 0.0023679 0.002559311</span></span>
<span><span class="co">#&gt;    beta_joint beta_joint_sp</span></span>
<span><span class="co">#&gt; 1 0.002373599   0.002444096</span></span>
<span></span>
<span><span class="va">frac_less_bias</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>beta_UMVCUE <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out2</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out2</span><span class="op">$</span><span class="va">beta_rep</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out2</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out2</span><span class="op">$</span><span class="va">beta_UMVCUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">out2</span><span class="op">)</span>, beta_com <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out1</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out1</span><span class="op">$</span><span class="va">beta_rep</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out1</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out1</span><span class="op">$</span><span class="va">beta_com</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">out1</span><span class="op">)</span>, beta_MLE <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out1</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out1</span><span class="op">$</span><span class="va">beta_rep</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out1</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out1</span><span class="op">$</span><span class="va">beta_MLE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">out1</span><span class="op">)</span>, beta_MSE <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out1</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out1</span><span class="op">$</span><span class="va">beta_rep</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out1</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out1</span><span class="op">$</span><span class="va">beta_MSE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">out1</span><span class="op">)</span>, beta_joint <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out3</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out3</span><span class="op">$</span><span class="va">beta_rep</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out3</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out3</span><span class="op">$</span><span class="va">beta_joint</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">out3</span><span class="op">)</span>, beta_joint_sp <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out4</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out4</span><span class="op">$</span><span class="va">beta_rep</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out4</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out4</span><span class="op">$</span><span class="va">beta_joint</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">out4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">frac_less_bias</span>  <span class="co"># comparison with naive replication estimate</span></span>
<span><span class="co">#&gt;   beta_UMVCUE  beta_com  beta_MLE  beta_MSE beta_joint beta_joint_sp</span></span>
<span><span class="co">#&gt; 1   0.4802632 0.4276316 0.5131579 0.4605263        0.5     0.4934211</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="using-empirical-bayes-method-when-a-replication-data-set-is-available">Using Empirical Bayes method when a replication data set is
available<a class="anchor" aria-label="anchor" href="#using-empirical-bayes-method-when-a-replication-data-set-is-available"></a>
</h3>
<ul>
<li><p>When a replication data set is also available, as has been
described throughout this document, we also have the option to employ
the empirical Bayes method. We have seen this work considerably well in
simulations and thus advise exploration of its implementation in this
setting.</p></li>
<li><p>With data in the form described above similar to
<code>stats_disc</code> and <code>stats_rep</code>, implementation of
the empirical Bayes method could take place on the combined estimator as
shown below:</p></li>
</ul>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="va">com_stats</span> <span class="op">&lt;-</span> <span class="va">stats_disc</span></span>
<span>  <span class="va">com_stats</span><span class="op">$</span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="op">(</span><span class="op">(</span><span class="op">(</span><span class="va">stats_rep</span><span class="op">$</span><span class="va">se</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="va">stats_disc</span><span class="op">$</span><span class="va">beta</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="op">(</span><span class="op">(</span><span class="op">(</span><span class="va">stats_disc</span><span class="op">$</span><span class="va">se</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="va">stats_rep</span><span class="op">$</span><span class="va">beta</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="op">(</span><span class="op">(</span><span class="va">stats_disc</span><span class="op">$</span><span class="va">se</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="op">(</span><span class="va">stats_rep</span><span class="op">$</span><span class="va">se</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">com_stats</span><span class="op">$</span><span class="va">se</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="op">(</span><span class="op">(</span><span class="op">(</span><span class="va">stats_disc</span><span class="op">$</span><span class="va">se</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="op">(</span><span class="va">stats_rep</span><span class="op">$</span><span class="va">se</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="op">(</span><span class="op">(</span><span class="va">stats_disc</span><span class="op">$</span><span class="va">se</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="op">(</span><span class="va">stats_rep</span><span class="op">$</span><span class="va">se</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">out_EB_com</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/empirical_bayes.html">empirical_bayes</a></span><span class="op">(</span><span class="va">com_stats</span><span class="op">)</span></span>
<span>  <span class="va">out_EB_com</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">out_EB_com</span>,<span class="va">out_EB_com</span><span class="op">$</span><span class="va">rsid</span><span class="op">)</span></span>
<span>  <span class="va">out_EB_com</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>rsid <span class="op">=</span> <span class="va">stats_disc</span><span class="op">$</span><span class="va">rsid</span>, beta_disc <span class="op">=</span> <span class="va">stats_disc</span><span class="op">$</span><span class="va">beta</span>, se_disc  <span class="op">=</span> <span class="va">stats_disc</span><span class="op">$</span><span class="va">se</span>, beta_rep <span class="op">=</span> <span class="va">stats_rep</span><span class="op">$</span><span class="va">beta</span>, se_rep <span class="op">=</span> <span class="va">stats_rep</span><span class="op">$</span><span class="va">se</span>, beta_EB<span class="op">=</span><span class="va">out_EB_com</span><span class="op">$</span><span class="va">beta_EB</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co">## reorder based on significance in first set up!</span></span>
<span>  <span class="va">out_EB_com</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">out_EB_com</span>, <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">out_EB_com</span><span class="op">$</span><span class="va">beta_disc</span><span class="op">/</span><span class="va">out_EB_com</span><span class="op">$</span><span class="va">se_disc</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">out_EB_com</span> <span class="op">&lt;-</span> <span class="va">out_EB_com</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">out_EB_com</span><span class="op">$</span><span class="va">beta_disc</span><span class="op">/</span><span class="va">out_EB_com</span><span class="op">$</span><span class="va">se_disc</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="op">(</span><span class="fl">10e-6</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>, lower.tail<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">out_EB_com</span><span class="op">)</span></span>
<span><span class="co">#&gt;   rsid   beta_disc     se_disc    beta_rep      se_rep     beta_EB</span></span>
<span><span class="co">#&gt; 1 3965  0.06064760 0.008191123  0.05034712 0.002590183  0.05099432</span></span>
<span><span class="co">#&gt; 2 7815  0.06273204 0.008477889  0.04711212 0.002680864  0.04823275</span></span>
<span><span class="co">#&gt; 3 4998 -0.05956742 0.008336576 -0.04797101 0.002636178 -0.04800400</span></span>
<span><span class="co">#&gt; 4 7261  0.05510736 0.008186396  0.05423749 0.002588688  0.05402757</span></span>
<span><span class="co">#&gt; 5 6510  0.05623389 0.008389116  0.05314707 0.002652792  0.05313153</span></span>
<span><span class="co">#&gt; 6 9917  0.05466029 0.008176299  0.04281451 0.002585495  0.04360270</span></span></code></pre></div>
<ul>
<li>We then compute the evaluation metrics as considered above as well
as create a plot depicting the results.</li>
</ul>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sq_diff</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>disc_naive <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out2</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out2</span><span class="op">$</span><span class="va">beta_disc</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, rep_naive <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out2</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out2</span><span class="op">$</span><span class="va">beta_rep</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,  beta_EB_joint <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out_EB_com</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out_EB_com</span><span class="op">$</span><span class="va">beta_EB</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sq_diff</span></span>
<span><span class="co">#&gt;   disc_naive   rep_naive beta_EB_joint</span></span>
<span><span class="co">#&gt; 1 0.06867092 0.001304645   0.001203244</span></span>
<span></span>
<span><span class="va">mean_abs_diff</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>disc_naive <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out2</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out2</span><span class="op">$</span><span class="va">beta_disc</span><span class="op">)</span><span class="op">)</span>, rep_naive <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out2</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out2</span><span class="op">$</span><span class="va">beta_rep</span><span class="op">)</span><span class="op">)</span>,  beta_EB_joint <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out_EB_com</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out_EB_com</span><span class="op">$</span><span class="va">beta_EB</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mean_abs_diff</span></span>
<span><span class="co">#&gt;   disc_naive   rep_naive beta_EB_joint</span></span>
<span><span class="co">#&gt; 1 0.01593473 0.002368839   0.002205367</span></span>
<span></span>
<span><span class="va">frac_less_bias</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>beta_EB_joint <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out_EB_com</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out_EB_com</span><span class="op">$</span><span class="va">beta_rep</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out_EB_com</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span> <span class="op">-</span> <span class="va">out_EB_com</span><span class="op">$</span><span class="va">beta_EB</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">out_EB_com</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">frac_less_bias</span>  <span class="co"># comparison with naive replication estimate</span></span>
<span><span class="co">#&gt;   beta_EB_joint</span></span>
<span><span class="co">#&gt; 1     0.5723684</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">out_EB_com</span><span class="op">$</span><span class="va">beta_disc</span><span class="op">)</span><span class="op">)</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">72</span><span class="op">)</span>,xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.01</span>,<span class="fl">0.08</span><span class="op">)</span>,main<span class="op">=</span><span class="st">"Empirical Bayes Winner's Curse Adjustment"</span>,col<span class="op">=</span><span class="va">col</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">true_beta</span><span class="op">[</span><span class="va">out_EB_com</span><span class="op">$</span><span class="va">rsid</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,col<span class="op">=</span><span class="va">col</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">out_EB_com</span><span class="op">$</span><span class="va">beta_rep</span><span class="op">)</span><span class="op">)</span>,col<span class="op">=</span><span class="va">col</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">out_EB_com</span><span class="op">$</span><span class="va">beta_EB</span><span class="op">)</span><span class="op">)</span>,col<span class="op">=</span><span class="va">col</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">70.5</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"beta_disc"</span>, <span class="st">"true_beta"</span>,<span class="st">"beta_rep"</span>,<span class="st">"beta_EB_joint"</span><span class="op">)</span>,</span>
<span>       col<span class="op">=</span><span class="va">col</span>,lty<span class="op">=</span><span class="fl">1</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="discovery_replication_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Amanda Forde.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
